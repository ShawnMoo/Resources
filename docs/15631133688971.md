# Runtime 相关面试
## Runtime常见问题 - 数据结构
![-w1253](media/15631133688971/15631142407510.jpg)

* objc_object:
![](media/15631133688971/15631147002886.jpg)

* objc_class:
![](media/15631133688971/15631150535365.jpg)

* isa指针:

![](media/15631133688971/15631153825198.jpg)

* isa指针的指向:
![](media/15631133688971/15631157179706.jpg)

* cache_t -- 方法缓存:
![](media/15631133688971/15631159403582.jpg)


![-w1243](media/15631133688971/15631984956494.jpg)

* class_data_bits_t:
![-w1139](media/15631133688971/15631994264365.jpg)

* class_t的结构：
![-w1167](media/15631133688971/15632003972719.jpg)

* class_ro_t:
![-w1062](media/15631133688971/15632010617916.jpg)

* method_t:
![-w1196](media/15631133688971/15632014834971.jpg)

Type_Encodings:
![-w1229](media/15631133688971/15632856565963.jpg)


runtime的基础数据结构：
![-w1258](media/15631133688971/15632863635120.jpg)


## Runtime常见问题 - 对象、类对象、元类对象
![-w989](media/15631133688971/15632882551115.jpg)

* 对象、类对象、元类对象的关系:
![-w1246](media/15631133688971/15632888665493.jpg)

* 消息传递: -- 先是消息查找，查找不到才会走消息转发流程
![-w1263](media/15631133688971/15636116464674.jpg)


## Runtime常见问题 -- 消息传递的具体流程
1. 缓存查找:
例子: 给定值是SEL,目标值是对应的bucket_t 中对应的IMP
 ![-w993](media/15631133688971/15636964472003.jpg)

2. 在当前类中查找
![-w1065](media/15631133688971/15636968681346.jpg)

3.在父类中逐级查找: 
![-w1232](media/15631133688971/15636972930938.jpg)

4.消息转发流程: 
![-w1278](media/15631133688971/15636988554662.jpg)



## Runtime常见问题 -- 方法交换 Method Swizzling

![-w1222](media/15631133688971/15637047329597.jpg)

* 动态方法添加:

```
// cls: 为哪个类添加方法
// name: 添加的Select名称
// imp:  自定义的IMP 实现
// types: typeEcoding 的值
class_addMethod(Class _Nullable cls, SEL _Nonnull name, IMP _Nonnull imp, const char * _Nullable types)

// 例如:class_addMethod(self, @selector(addMethod), addMethodImp, "v@:");
   
```

* 动态方法解析:
![-w871](media/15631133688971/15637086155313.jpg)
